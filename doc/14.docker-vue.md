
使用 docker 部署 vue

参考：

[https://juejin.im/post/5cce4b1cf265da0373719819#heading-23](https://juejin.im/post/5cce4b1cf265da0373719819#heading-23)

# 方式一 使用 Dockerfile 构建镜像

```
# Dockerfile

FROM nginx

COPY nginx/default.conf /etc/nginx/conf.d/default.conf
```

`./nginx/default.conf`

```
server {
    listen       80;
    server_name  localhost;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }

    error_page   500 502 503 504  /50x.html;

    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    ssi on;
    
}
```

创建镜像:

```
docker build -t vuecontainer .
```

查看镜像:

```
docker images
```

运行镜像:

```
docker run \
-p 3000:80 \
-d --name vuenginxnew \
--mount type=bind,source=/Users/double/webWorkSpace/pvue/nginx,target=/etc/nginx/conf.d \
--mount type=bind,source=/Users/double/webWorkSpace/pvue/dist,target=/usr/share/nginx/html \
nginx
```


>-d 后台运行， --name:容器名称, -p 映射端口

查看运行情况:

```
docker ps
```

访问: `http://localhost`

## 问题

这种方式使用 docker, 在代码修改后，重新部署的时候，需要重启容器，才会生效。


## docker.sh 运行脚本

`docker.sh`

```shell
#!/bin/bash

echo "start npm run install & npm run build"

npm run install & npm run build

container=$(docker container ls -a | grep vuenginxnew)
if [ -n "$container" ]; then
    echo "container is existed, restart container"
    docker stop vuenginxnew
    docker start vuenginxnew 
else
    echo "container not exist , create & start container success"
    docker run \
    -p 3000:80 \
    -d --name vuenginxnew \
    --mount type=bind,source=/Users/double/webWorkSpace/pvue/nginx,target=/etc/nginx/conf.d \
    --mount type=bind,source=/Users/double/webWorkSpace/pvue/dist,target=/usr/share/nginx/html \
    nginx
fi
```

